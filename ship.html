<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHL Backup Solution - Create Shipment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="bg-white shadow-md py-4 px-6 md:px-10 flex justify-between items-center relative z-10 rounded-b-xl">
        <a href="index.html" class="flex items-center"><span class="text-4xl font-bold text-red-600">DHL</span><span class="ml-2 text-xl font-semibold text-gray-800  sm:block">Backup Solution</span></a>
        <nav id="desktop-utilities-nav" class=" md:flex items-center space-x-4">
            <div class="relative">
                <button id="language-toggle-button" class="utility-button px-4 py-2 flex items-center gap-2"><span id="current-language-display"></span><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                <div id="language-dropdown" class="language-dropdown absolute right-0 mt-2 w-28 bg-white rounded-md shadow-lg hidden z-20">
                    <a href="#" class="block px-4 py-2" data-lang="th">ภาษาไทย</a><a href="#" class="block px-4 py-2" data-lang="en">English</a>
                </div>
            </div>
            <button id="theme-toggle" class="utility-button">
                <svg id="theme-icon-light" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="theme-icon-dark" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </nav>
        <button id="mobile-menu-button" class="md:hidden text-gray-700 p-2 rounded-md"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button>
    </header>

    <main class="container py-8">
        <section id="ship-now-page" class="card max-w-4xl mx-auto">
            <h1 class="text-3xl font-extrabold text-center mb-8" data-i18n="createShipment"></h1>
            <div class="relative">
                <div class="progress-bar">
                    <div class="progress-line-fill"></div>
                    <div id="step-1" class="progress-step"><div class="step-circle">1</div><p class="step-text" data-i18n="originStep"></p></div>
                    <div id="step-2" class="progress-step"><div class="step-circle">2</div><p class="step-text" data-i18n="destinationStep"></p></div>
                    <div id="step-3" class="progress-step"><div class="step-circle">3</div><p class="step-text" data-i18n="packageStep"></p></div>
                    <div id="step-4" class="progress-step"><div class="step-circle">4</div><p class="step-text" data-i18n="reviewConfirm"></p></div>
                </div>
            </div>
            
            <form id="ship-now-form" class="space-y-6" novalidate>
                 <div id="form-message" class="p-4 rounded-md text-center hidden"></div>
                 <div id="ship-now-step-1" class="ship-now-step space-y-4 p-4 border rounded-lg bg-yellow-50">
                    <h2 class="text-xl font-semibold" data-i18n="originInfo"></h2>
                    <div><label class="block text-sm font-medium mb-1" data-i18n="originCountry"></label><select id="ship-origin-country" class="input-field" required><option value="" data-i18n="selectCountry"></option></select></div>
                    <div><label class="block text-sm font-medium mb-1" data-i18n="originCity"></label><input type="text" id="ship-origin-city" class="input-field" required data-i18n-placeholder="enterCity"></div>
                    <div><label class="block text-sm font-medium mb-1" data-i18n="originPostalCodeRequired"></label><input type="text" id="ship-origin-postalcode" class="input-field" required data-i18n-placeholder="enterPostalCode"></div>
                </div>
                <div id="ship-now-step-2" class="ship-now-step space-y-4 p-4 border rounded-lg bg-yellow-50 hidden-page">
                    <h2 class="text-xl font-semibold" data-i18n="destinationInfo"></h2>
                    <div><label class="block text-sm font-medium mb-1" data-i18n="destinationCountry"></label><select id="ship-destination-country" class="input-field" required><option value="" data-i18n="selectCountry"></option></select></div>
                    <div><label class="block text-sm font-medium mb-1" data-i18n="destinationCity"></label><input type="text" id="ship-destination-city" class="input-field" required data-i18n-placeholder="enterCity"></div>
                    <div><label class="block text-sm font-medium mb-1" data-i18n="destinationPostalCodeRequired"></label><input type="text" id="ship-destination-postalcode" class="input-field" required data-i18n-placeholder="enterPostalCode"></div>
                </div>
                <div id="ship-now-step-3" class="ship-now-step space-y-4 p-4 border rounded-lg bg-yellow-50 hidden-page">
                    <h2 class="text-xl font-semibold" data-i18n="packageDetails"></h2>
                    <div><label class="block text-sm font-medium mb-1" data-i18n="shipmentDate"></label><input type="date" id="ship-date" class="input-field" required></div>
                    <div class="flex items-center mt-2"><input type="checkbox" id="is-parcel" class="form-checkbox h-5 w-5 text-red-600 rounded-md"><label for="is-parcel" class="ml-2 block text-sm" data-i18n="isParcel"></label></div>
                    <div id="declared-value-container" class="hidden"><label class="block text-sm font-medium mb-1" data-i18n="declaredValue"></label><input type="number" id="declared-value" min="0" step="0.01" class="input-field" data-i18n-placeholder="enterDeclaredValue"></div>
                    <div id="package-pieces-container"></div>
                    <button type="button" id="add-piece-button" class="w-full btn-primary btn-red mt-2" data-i18n="addPiece"></button>
                </div>
                <div id="ship-now-step-4" class="ship-now-step space-y-6 p-4 border rounded-lg bg-yellow-50 hidden-page">
                    <h2 class="text-xl font-semibold" data-i18n="reviewConfirm"></h2>
                    <div class="space-y-3"><p><strong data-i18n="originInfo"></strong> <span id="review-origin"></span></p><p><strong data-i18n="destinationInfo"></strong> <span id="review-destination"></span></p><p class="font-medium" data-i18n="packageDetails"></p><ul id="review-package-list" class="list-disc list-inside ml-4"></ul></div>
                </div>
                 <div class="flex justify-between gap-4 mt-6">
                    <button type="button" id="ship-now-prev-step" class="btn-primary btn-gray" data-i18n="previous"></button>
                    <button type="button" id="ship-now-next-step" class="flex-1 btn-primary btn-yellow" data-i18n="next"></button>
                    <button type="submit" id="confirm-shipment-button" class="flex-1 btn-primary btn-red" data-i18n="confirmShipment"></button>
                    <a href="index.html" id="back-to-main-link" class="btn-primary btn-gray" data-i18n="backToMain"></a>
                </div>
            </form>
        </section>
    </main>
    <footer class="bg-gray-800 text-white py-8 mt-8"><div class="text-center text-sm text-gray-400">&copy; <span id="current-year"></span> DHL Express. <span data-i18n="allRightsReserved"></span></div></footer>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const translations = {'th':{'createShipment':'สร้างใบนำส่ง','originStep':'ต้นทาง','destinationStep':'ปลายทาง','packageStep':'พัสดุ','reviewConfirm':'สรุป','originInfo':'ข้อมูลต้นทาง:','destinationInfo':'ข้อมูลปลายทาง:','packageDetails':'รายละเอียดพัสดุ:','originCountry':'ประเทศต้นทาง:','destinationCountry':'ประเทศปลายทาง:','shipmentDate':'วันที่จัดส่ง:','isParcel':'พัสดุ','declaredValue':'มูลค่าสินค้า:','addPiece':'เพิ่มชิ้นพัสดุ','confirmShipment':'ยืนยันการจัดส่ง','previous':'ย้อนกลับ','next':'ถัดไป','backToMain':'กลับสู่หน้าหลัก','selectCountry':'เลือกประเทศ','fillAllFields':'กรุณากรอกข้อมูลให้ครบถ้วน','pieceNumber':'ชิ้นที่','lengthCm':'ยาว (ซม.):','widthCm':'กว้าง (ซม.):','heightCm':'สูง (ซม.):','weightKg':'นน. (กก.):','allRightsReserved':'สงวนลิขสิทธิ์.'},'en':{'createShipment':'Create Shipment','originStep':'Origin','destinationStep':'Destination','packageStep':'Package','reviewConfirm':'Summary','originInfo':'Origin:','destinationInfo':'Destination:','packageDetails':'Details:','originCountry':'Origin Country:','destinationCountry':'Destination Country:','shipmentDate':'Shipment Date:','isParcel':'Parcel','declaredValue':'Declared Value:','addPiece':'Add Piece','confirmShipment':'Confirm Shipment','previous':'Previous','next':'Next','backToMain':'Back to Main','selectCountry':'Select Country','fillAllFields':'Please fill all fields.','pieceNumber':'Piece','lengthCm':'Length(cm):','widthCm':'Width(cm):','heightCm':'Height(cm):','weightKg':'Weight(kg):','allRightsReserved':'All rights reserved.'}};
        const countryList = [ { "name": "Afghanistan", "code": "AF" }, { "name": "Albania", "code": "AL" }, { "name": "Algeria", "code": "DZ" }, { "name": "American Samoa", "code": "AS" }, { "name": "Andorra", "code": "AD" }, { "name": "Angola", "code": "AO" }, { "name": "Anguilla", "code": "AI" }, { "name": "Antigua", "code": "AG" }, { "name": "Argentina", "code": "AR" }, { "name": "Armenia", "code": "AM" }, { "name": "Aruba", "code": "AW" }, { "name": "Australia", "code": "AU" }, { "name": "Austria", "code": "AT" }, { "name": "Azerbaijan", "code": "AZ" }, { "name": "Bahamas", "code": "BS" }, { "name": "Bahrain", "code": "BH" }, { "name": "Bangladesh", "code": "BD" }, { "name": "Barbados", "code": "BB" }, { "name": "Belarus", "code": "BY" }, { "name": "Belgium", "code": "BE" }, { "name": "Belize", "code": "BZ" }, { "name": "Benin", "code": "BJ" }, { "name": "Bermuda", "code": "BM" }, { "name": "Bhutan", "code": "BT" }, { "name": "Bolivia", "code": "BO" }, { "name": "Bonaire", "code": "BQ" }, { "name": "Bosnia and Herzegovina", "code": "BA" }, { "name": "Botswana", "code": "BW" }, { "name": "Brazil", "code": "BR" }, { "name": "Brunei", "code": "BN" }, { "name": "Bulgaria", "code": "BG" }, { "name": "Burkina Faso", "code": "BF" }, { "name": "Burundi", "code": "BI" }, { "name": "Cambodia", "code": "KH" }, { "name": "Cameroon", "code": "CM" }, { "name": "Canada", "code": "CA" }, { "name": "Canary Islands, The", "code": "IC" }, { "name": "Cape Verde", "code": "CV" }, { "name": "Cayman Islands", "code": "KY" }, { "name": "Central African Republic", "code": "CF" }, { "name": "Chad", "code": "TD" }, { "name": "Chile", "code": "CL" }, { "name": "China, People's Republic", "code": "CN" }, { "name": "Colombia", "code": "CO" }, { "name": "Comoros", "code": "KM" }, { "name": "Congo", "code": "CG" }, { "name": "Congo, The Democratic Republic of", "code": "CD" }, { "name": "Cook Islands", "code": "CK" }, { "name": "Costa Rica", "code": "CR" }, { "name": "Cote D'ivoire", "code": "CI" }, { "name": "Croatia", "code": "HR" }, { "name": "Cuba", "code": "CU" }, { "name": "Curacao", "code": "CW" }, { "name": "Cyprus", "code": "CY" }, { "name": "Czech Republic, The", "code": "CZ" }, { "name": "Denmark", "code": "DK" }, { "name": "Djibouti", "code": "DJ" }, { "name": "Dominica", "code": "DM" }, { "name": "Dominican Republic", "code": "DO" }, { "name": "East Timor", "code": "TL" }, { "name": "Ecuador", "code": "EC" }, { "name": "Egypt", "code": "EG" }, { "name": "El Salvador", "code": "SV" }, { "name": "Eritrea", "code": "ER" }, { "name": "Estonia", "code": "EE" }, { "name": "Ethiopia", "code": "ET" }, { "name": "Falkland Islands", "code": "FK" }, { "name": "Faroe Islands", "code": "FO" }, { "name": "Fiji", "code": "FJ" }, { "name": "Finland", "code": "FI" }, { "name": "France", "code": "FR" }, { "name": "French Guyana", "code": "GF" }, { "name": "Gabon", "code": "GA" }, { "name": "Gambia", "code": "GM" }, { "name": "Georgia", "code": "GE" }, { "name": "Germany", "code": "DE" }, { "name": "Ghana", "code": "GH" }, { "name": "Gibraltar", "code": "GI" }, { "name": "Greece", "code": "GR" }, { "name": "Greenland", "code": "GL" }, { "name": "Grenada", "code": "GD" }, { "name": "Guadeloupe", "code": "GP" }, { "name": "Guam", "code": "GU" }, { "name": "Guatemala", "code": "GT" }, { "name": "Guernsey", "code": "GG" }, { "name": "Guinea Republic", "code": "GN" }, { "name": "Guinea-Bissau", "code": "GW" }, { "name": "Guinea-Equatorial", "code": "GQ" }, { "name": "Guyana", "code": "GY" }, { "name": "Haiti", "code": "HT" }, { "name": "Honduras", "code": "HN" }, { "name": "Hong Kong", "code": "HK" }, { "name": "Hungary", "code": "HU" }, { "name": "Iceland", "code": "IS" }, { "name": "India", "code": "IN" }, { "name": "Indonesia", "code": "ID" }, { "name": "Iran (Islamic Republic of)", "code": "IR" }, { "name": "Iraq", "code": "IQ" }, { "name": "Ireland, Republic of", "code": "IE" }, { "name": "Israel", "code": "IL" }, { "name": "Italy", "code": "IT" }, { "name": "Jamaica", "code": "JM" }, { "name": "Japan", "code": "JP" }, { "name": "Jersey", "code": "JE" }, { "name": "Jordan", "code": "JO" }, { "name": "Kazakhstan", "code": "KZ" }, { "name": "Kenya", "code": "KE" }, { "name": "Kiribati", "code": "KI" }, { "name": "Korea, Republic of", "code": "KR" }, { "name": "Korea, The D.P.R of (North K.)", "code": "KP" }, { "name": "Kosovo", "code": "KV" }, { "name": "Kuwait", "code": "KW" }, { "name": "Kyrgyzstan", "code": "KG" }, { "name": "Lao People's Democratic Republic", "code": "LA" }, { "name": "Latvia", "code": "LV" }, { "name": "Lebanon", "code": "LB" }, { "name": "Lesotho", "code": "LS" }, { "name": "Liberia", "code": "LR" }, { "name": "Libya", "code": "LY" }, { "name": "Liechtenstein", "code": "LI" }, { "name": "Lithuania", "code": "LT" }, { "name": "Luxembourg", "code": "LU" }, { "name": "Macau", "code": "MO" }, { "name": "Macedonia, Republic of", "code": "MK" }, { "name": "Madagascar", "code": "MG" }, { "name": "Malawi", "code": "MW" }, { "name": "Malaysia", "code": "MY" }, { "name": "Maldives", "code": "MV" }, { "name": "Mali", "code": "ML" }, { "name": "Malta", "code": "MT" }, { "name": "Marshall Islands", "code": "MH" }, { "name": "Martinique", "code": "MQ" }, { "name": "Mauritania", "code": "MR" }, { "name": "Mauritius", "code": "MU" }, { "name": "Mayotte", "code": "YT" }, { "name": "Mexico", "code": "MX" }, { "name": "Micronesia, Federated States of", "code": "FM" }, { "name": "Moldova, Republic of", "code": "MD" }, { "name": "Monaco", "code": "MC" }, { "name": "Mongolia", "code": "MN" }, { "name": "Montenegro, Republic of", "code": "ME" }, { "name": "Montserrat", "code": "MS" }, { "name": "Morocco", "code": "MA" }, { "name": "Mozambique", "code": "MZ" }, { "name": "Myanmar", "code": "MM" }, { "name": "Namibia", "code": "NA" }, { "name": "Nauru, Republic of", "code": "NR" }, { "name": "Nepal", "code": "NP" }, { "name": "Netherlands, The", "code": "NL" }, { "name": "New Caledonia", "code": "NC" }, { "name": "New Zealand", "code": "NZ" }, { "name": "Nicaragua", "code": "NI" }, { "name": "Niger", "code": "NE" }, { "name": "Nigeria", "code": "NG" }, { "name": "Niue", "code": "NU" }, { "name": "Northern Mariana Islands", "code": "MP" }, { "name": "Norway", "code": "NO" }, { "name": "Oman", "code": "OM" }, { "name": "Pakistan", "code": "PK" }, { "name": "Palau", "code": "PW" }, { "name": "Panama", "code": "PA" }, { "name": "Papua New Guinea", "code": "PG" }, { "name": "Paraguay", "code": "PY" }, { "name": "Peru", "code": "PE" }, { "name": "Philippines, The", "code": "PH" }, { "name": "Poland", "code": "PL" }, { "name": "Portugal", "code": "PT" }, { "name": "Puerto Rico", "code": "PR" }, { "name": "Qatar", "code": "QA" }, { "name": "Reunion, Island of", "code": "RE" }, { "name": "Romania", "code": "RO" }, { "name": "Russian Federation, The", "code": "RU" }, { "name": "Rwanda", "code": "RW" }, { "name": "Saipan", "code": "SP" }, { "name": "San Marino", "code": "SM" }, { "name": "Sao Tome and Principe", "code": "ST" }, { "name": "Saudi Arabia", "code": "SA" }, { "name": "Senegal", "code": "SN" }, { "name": "Serbia, Republic of", "code": "RS" }, { "name": "Seychelles", "code": "SC" }, { "name": "Sierra Leone", "code": "SL" }, { "name": "Singapore", "code": "SG" }, { "name": "Slovakia", "code": "SK" }, { "name": "Slovenia", "code": "SI" }, { "name": "Solomon Islands", "code": "SB" }, { "name": "Somalia", "code": "SO" }, { "name": "Somaliland, Rep of (North Somalia)", "code": "XS" }, { "name": "South Africa", "code": "ZA" }, { "name": "South Sudan", "code": "SS" }, { "name": "Spain", "code": "ES" }, { "name": "Sri Lanka", "code": "LK" }, { "name": "St. Barthelemy", "code": "XY" }, { "name": "St. Eustatius", "code": "XE" }, { "name": "St. Helena", "code": "SH" }, { "name": "St. Kitts and Nevis", "code": "KN" }, { "name": "St. Lucia", "code": "LC" }, { "name": "St. Maarten", "code": "SX" }, { "name": "St. Vincent", "code": "VC" }, { "name": "Sudan", "code": "SD" }, { "name": "Suriname", "code": "SR" }, { "name": "Swaziland", "code": "SZ" }, { "name": "Sweden", "code": "SE" }, { "name": "Switzerland", "code": "CH" }, { "name": "Syria", "code": "SY" }, { "name": "Tahiti", "code": "PF" }, { "name": "Taiwan", "code": "TW" }, { "name": "Tanzania", "code": "TZ" }, { "name": "Thailand", "code": "TH" }, { "name": "Togo", "code": "TG" }, { "name": "Tonga", "code": "TO" }, { "name": "Trinidad and Tobago", "code": "TT" }, { "name": "Tunisia", "code": "TN" }, { "name": "Turkey", "code": "TR" }, { "name": "Turkmenistan", "code": "TM" }, { "name": "Turks and Caicos Islands", "code": "TC" }, { "name": "Tuvalu", "code": "TV" }, { "name": "Uganda", "code": "UG" }, { "name": "Ukraine", "code": "UA" }, { "name": "United Arab Emirates", "code": "AE" }, { "name": "United Kingdom", "code": "GB" }, { "name": "United States of America", "code": "US" }, { "name": "Uruguay", "code": "UY" }, { "name": "Uzbekistan", "code": "UZ" }, { "name": "Vanuatu", "code": "VU" }, { "name": "Vatican City", "code": "VA" }, { "name": "Venezuela", "code": "VE" }, { "name": "Vietnam", "code": "VN" }, { "name": "Virgin Islands (British)", "code": "VG" }, { "name": "Virgin Islands (US)", "code": "VI" }, { "name": "Yemen, Republic of", "code": "YE" }, { "name": "Zambia", "code": "ZM" }, { "name": "Zimbabwe", "code": "ZW" } ];
        let currentLanguage = localStorage.getItem('language') || 'th';
        let currentStep = 0;
        let packagePieces = [{ length: '', width: '', height: '', weight: '' }];
        let hasUnsavedChanges = false;
        const totalSteps = 4;
        const formMessage = document.getElementById('form-message');
        const shipNowForm = document.getElementById('ship-now-form');
        function getTranslatedText(key, replacements = {}) { let text = translations[currentLanguage]?.[key] || key; for (const placeholder in replacements) { text = text.replace(`{${placeholder}}`, replacements[placeholder]); } return text; }
        const populateShipNowCountrySelects = () => { ['ship-origin-country', 'ship-destination-country'].forEach(id => { const select = document.getElementById(id); if (!select) return; const currentValue = select.value; select.innerHTML = `<option value="">${getTranslatedText('selectCountry')}</option>`; countryList.forEach(country => { select.innerHTML += `<option value="${country.code}">${country.name}</option>`; }); select.value = currentValue; }); };
        const renderPackagePieces = () => { const container = document.getElementById('package-pieces-container'); if(!container) return; container.innerHTML = ''; packagePieces.forEach((piece, index) => { const pieceDiv = document.createElement('div'); pieceDiv.className = 'package-piece-item border rounded-md p-4 mb-4 bg-white shadow-sm relative'; pieceDiv.innerHTML = `<h3 class="text-lg font-medium mb-3">${getTranslatedText('pieceNumber')} ${index + 1}</h3> ${packagePieces.length > 1 ? `<button type="button" class="absolute top-2 right-2 text-red-500 font-bold" data-index="${index}">✖</button>` : ''} <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4"> <div><label class="block text-sm">${getTranslatedText('lengthCm')}</label><input type="number" min="0.1" step="0.1" class="input-field" value="${piece.length}" data-field="length" required></div> <div><label class="block text-sm">${getTranslatedText('widthCm')}</label><input type="number" min="0.1" step="0.1" class="input-field" value="${piece.width}" data-field="width" required></div> <div><label class="block text-sm">${getTranslatedText('heightCm')}</label><input type="number" min="0.1" step="0.1" class="input-field" value="${piece.height}" data-field="height" required></div> <div><label class="block text-sm">${getTranslatedText('weightKg')}</label><input type="number" min="0.1" step="0.1" class="input-field" value="${piece.weight}" data-field="weight" required></div> </div>`; container.appendChild(pieceDiv); }); container.querySelectorAll('input').forEach(input => { const pieceDiv = input.closest('.package-piece-item'); const index = Array.from(container.children).indexOf(pieceDiv); input.addEventListener('input', e => { packagePieces[index][e.target.dataset.field] = e.target.value; hasUnsavedChanges = true; }); }); container.querySelectorAll('button[data-index]').forEach(button => { button.addEventListener('click', e => { packagePieces.splice(parseInt(e.currentTarget.dataset.index), 1); renderPackagePieces(); hasUnsavedChanges = true; }); }); };
        const updateStepIndicator = () => { const lineFill = document.querySelector('.progress-line-fill'); for (let i = 0; i < totalSteps; i++) { const stepEl = document.getElementById(`step-${i + 1}`); stepEl.classList.remove('is-active', 'is-complete'); if (i === currentStep) { stepEl.classList.add('is-active'); } else if (i < currentStep) { stepEl.classList.add('is-complete'); } } if(lineFill) { const percentage = currentStep > 0 ? (currentStep / (totalSteps - 1)) * 75 : 0; lineFill.style.width = `${percentage}%`; }};
        const updateNavButtons = () => { document.getElementById('ship-now-prev-step').classList.toggle('hidden', currentStep === 0); document.getElementById('back-to-main-link').classList.toggle('hidden', currentStep !== 0); document.getElementById('ship-now-next-step').classList.toggle('hidden', currentStep >= totalSteps - 1); document.getElementById('confirm-shipment-button').classList.toggle('hidden', currentStep !== totalSteps - 1); };
        const populateReviewStep = () => { const originCountrySelect = document.getElementById('ship-origin-country'); const destinationCountrySelect = document.getElementById('ship-destination-country'); const originCountryName = originCountrySelect.options[originCountrySelect.selectedIndex].text; const destinationCountryName = destinationCountrySelect.options[destinationCountrySelect.selectedIndex].text; document.getElementById('review-origin').textContent = `${document.getElementById('ship-origin-city').value}, ${originCountryName}`; document.getElementById('review-destination').textContent = `${document.getElementById('ship-destination-city').value}, ${destinationCountryName}`; const list = document.getElementById('review-package-list'); list.innerHTML = ''; packagePieces.forEach((p, i) => { const li = document.createElement('li'); li.textContent = `${getTranslatedText('pieceNumber')} ${i+1}: ${p.length || 0}x${p.width || 0}x${p.height || 0} cm, ${p.weight || 0} kg`; list.appendChild(li); }); };
        const changeStep = (newStep) => { document.getElementById(`ship-now-step-${currentStep + 1}`).classList.add('hidden-page'); currentStep = newStep; document.getElementById(`ship-now-step-${currentStep + 1}`).classList.remove('hidden-page'); updateStepIndicator(); updateNavButtons(); if (currentStep === totalSteps - 1) populateReviewStep(); };
        const validateCurrentStep = () => { let isValid = true; const stepDiv = document.getElementById(`ship-now-step-${currentStep + 1}`); stepDiv.querySelectorAll('input[required], select[required]').forEach(i => { if (!i.value.trim()) isValid = false; }); if (currentStep === 2) { if (packagePieces.length === 0) isValid = false; packagePieces.forEach(p => { if (!p.length || !p.width || !p.height || !p.weight) isValid = false; }); } formMessage.classList.toggle('hidden', isValid); if (!isValid) formMessage.textContent = getTranslatedText('fillAllFields'); return isValid; };
        function updateContentLanguage(pageSpecificSetup) { document.querySelectorAll('[data-i18n]').forEach(el => { el.textContent = getTranslatedText(el.getAttribute('data-i18n')); }); document.querySelectorAll('[data-i18n-placeholder]').forEach(el => { el.placeholder = getTranslatedText(el.getAttribute('data-i18n-placeholder')); }); document.getElementById('current-language-display').textContent = currentLanguage.toUpperCase(); if (typeof pageSpecificSetup === 'function') pageSpecificSetup(); }
        function setupTheme() { const themeToggle = document.getElementById('theme-toggle'); const lightIcon = document.getElementById('theme-icon-light'); const darkIcon = document.getElementById('theme-icon-dark'); const enableDarkMode = () => { document.body.classList.add('dark-mode'); localStorage.setItem('theme', 'dark'); lightIcon.classList.remove('hidden'); darkIcon.classList.add('hidden'); }; const disableDarkMode = () => { document.body.classList.remove('dark-mode'); localStorage.setItem('theme', 'light'); lightIcon.classList.add('hidden'); darkIcon.classList.remove('hidden'); }; themeToggle.addEventListener('click', () => document.body.classList.contains('dark-mode') ? disableDarkMode() : enableDarkMode()); if (localStorage.getItem('theme') === 'dark') { enableDarkMode(); } else { disableDarkMode(); } }
        function setupLanguageSwitch(pageSpecificSetup) { document.getElementById('language-toggle-button').addEventListener('click', () => document.getElementById('language-dropdown').classList.toggle('hidden')); document.querySelectorAll('[data-lang]').forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); currentLanguage = e.target.dataset.lang; localStorage.setItem('language', currentLanguage); updateContentLanguage(pageSpecificSetup); document.getElementById('language-dropdown').classList.add('hidden'); }); }); }
        function initializeSharedComponents(pageSpecificSetup) { setupTheme(); setupLanguageSwitch(pageSpecificSetup); document.getElementById('current-year').textContent = new Date().getFullYear(); updateContentLanguage(pageSpecificSetup); }
        function pageSetup() { document.title = `DHL Backup Solution - ${getTranslatedText('createShipment')}`; populateShipNowCountrySelects(); renderPackagePieces(); updateStepIndicator(); }
        initializeSharedComponents(pageSetup);
        const shipDateInput = document.getElementById('ship-date');
        if(shipDateInput) shipDateInput.value = new Date().toISOString().slice(0, 10);
        changeStep(0);
        shipNowForm.addEventListener('input', () => { hasUnsavedChanges = true; });
        window.addEventListener('beforeunload', (e) => { if (hasUnsavedChanges) { e.preventDefault(); e.returnValue = ''; }});
        document.getElementById('ship-now-next-step').addEventListener('click', () => { if (validateCurrentStep()) changeStep(currentStep + 1); });
        document.getElementById('ship-now-prev-step').addEventListener('click', () => changeStep(currentStep - 1));
        document.getElementById('add-piece-button').addEventListener('click', () => { packagePieces.push({ length: '', width: '', height: '', weight: '' }); renderPackagePieces(); });
        document.getElementById('is-parcel').addEventListener('change', e => document.getElementById('declared-value-container').classList.toggle('hidden', !e.target.checked));
        shipNowForm.addEventListener('submit', (e) => { e.preventDefault(); hasUnsavedChanges = false; formMessage.textContent = getTranslatedText('shipmentInProgress'); formMessage.className = 'p-4 rounded-md text-center bg-green-100 text-green-700'; formMessage.classList.remove('hidden'); });
    });
    </script>
</body>
</html>

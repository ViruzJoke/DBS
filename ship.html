<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHL Backup Solution - สร้างใบนำส่ง</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Changed back to dark grey */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }
        main {
            flex-grow: 1;
            padding: 2rem 1rem;
        }
        .container {
            max-width: 1280px; /* Equivalent to container max-w-7xl */
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }
        .rounded-box {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
            padding: 2.5rem; /* p-10 */
        }
        .input-field {
            width: 100%;
            padding: 0.75rem 1rem; /* py-2 px-4 */
            border: 1px solid black; /* Changed from #d1d5db to black */
            border-radius: 0.375rem; /* rounded-md */
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            box-sizing: border-box; /* Include padding in element's total width and height */
        }
        .input-field:focus {
            outline: none;
            border-color: #dc2626; /* Changed from blue to red-600 */
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2); /* Changed from blue shadow to red-600 shadow */
        }
        .btn-primary {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem; /* px-6 py-3 */
            font-weight: 600; /* font-semibold */
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
            color: #ffffff;
        }
        /* No longer using btn-red-yellow as a gradient. Instead, specific solid yellow/red. */
        .btn-red {
            background-color: #dc2626; /* red-600 */
            color: white;
        }
        .btn-red:hover {
            background-color: #b91c1c; /* red-700 */
            transform: translateY(-1px);
        }
        .btn-red:active {
            transform: translateY(0);
        }
        .btn-yellow { /* Solid yellow button */
            background-color: #fbbf24; /* yellow-500 */
            color: black; /* text-black */
        }
        .btn-yellow:hover {
            background-color: #f59e0b; /* yellow-600 */
            transform: translateY(-1px);
        }
        .btn-yellow:active {
            transform: translateY(0);
        }

        .btn-gray {
            background-color: #d1d5db; /* Keep as gray-300 (neutral light gray) */
            color: #1f2937; /* Keep as gray-800 (neutral dark gray/black) */
        }
        .btn-gray:hover {
            background-color: #9ca3af; /* Keep as gray-400 (neutral medium gray) */
            transform: translateY(-1px);
        }
        .btn-gray:active {
            transform: translateY(0);
        }
        /* The previous btn-green is now replaced by btn-yellow where it was used for confirm button */
        /* Retaining for any unintended lingering uses, but ensure it aligns with yellow/red/white/black theme */
        .btn-green {
            background-color: #fbbf24; /* Changed to yellow-500 */
            color: black; /* Changed to black */
        }
        .btn-green:hover {
            background-color: #f59e0b; /* Changed to yellow-600 */
            transform: translateY(0);
        }
        .btn-green:active {
            transform: translateY(0);
        }

        /* Mobile menu specific styles */
        .mobile-menu-open {
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 0 0 0.75rem 0.75rem;
            padding: 1rem;
            animation: fadeInDown 0.3s ease-out;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hidden-page {
            display: none;
        }
    </style>
</head>
<body>

    <!-- Header Section -->
    <header class="bg-white shadow-md py-4 px-6 md:px-10 flex justify-between items-center relative z-10 rounded-b-xl">
        <div class="flex items-center">
            <span class="text-4xl font-bold text-red-600">DHL</span>
            <span class="ml-2 text-xl font-semibold text-gray-800 hidden sm:block">Backup Solution</span>
        </div>

        <!-- Mobile Menu Button -->
        <button id="mobile-menu-button" class="md:hidden text-gray-700 focus:outline-none focus:ring-2 focus:ring-red-600 p-2 rounded-md" aria-label="Open menu">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>

        <!-- Desktop Navigation -->
        <nav id="desktop-nav" class="hidden md:flex space-x-6">
            <a href="index.html" class="text-gray-700 hover:text-red-600 font-medium transition-colors duration-200">หน้าแรก</a>
            <a href="index.html#contact-info-section" class="text-gray-700 hover:text-red-600 font-medium transition-colors duration-200">ติดต่อเรา</a>
            <a href="index.html#tracking-section" class="px-4 py-2 bg-yellow-500 text-black rounded-full hover:bg-yellow-600 transition-colors duration-200 font-semibold">ติดตามพัสดุ</a>
        </nav>

        <!-- Mobile Navigation (Responsive) -->
        <div id="mobile-menu" class="hidden">
            <nav class="flex flex-col space-y-4">
                <a href="index.html" class="text-gray-700 hover:text-red-600 font-medium py-2 border-b border-gray-200" onclick="closeMobileMenu();">หน้าแรก</a>
                <a href="index.html#contact-info-section" class="text-gray-700 hover:text-red-600 font-medium py-2 border-b border-gray-200" onclick="closeMobileMenu();">ติดต่อเรา</a>
                <a href="index.html#tracking-section" class="px-4 py-2 bg-yellow-500 text-black rounded-full hover:bg-yellow-600 transition-colors duration-200 font-semibold text-center mt-2" onclick="closeMobileMenu();">ติดตามพัสดุ</a>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="container mx-auto px-4 py-8">

        <!-- Ship Now Page Content -->
        <section id="ship-now-page" class="page-content">
            <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 lg:p-10 w-full max-w-4xl mb-8 mx-auto">
                <h1 class="text-3xl sm:text-4xl font-extrabold text-yellow-500 text-center mb-8">
                    <span class="text-red-600">DHL</span> Ship Now
                </h1>

                <!-- Progress Indicator -->
                <div class="flex justify-between mb-8">
                    <div class="flex-1 text-center">
                        <div id="step-1-indicator" class="w-8 h-8 mx-auto rounded-full flex items-center justify-center text-white font-bold bg-red-600">1</div>
                        <p class="text-xs mt-2 text-red-600 font-semibold">ข้อมูลต้นทาง</p>
                    </div>
                    <div class="flex-1 text-center">
                        <div id="step-2-indicator" class="w-8 h-8 mx-auto rounded-full flex items-center justify-center text-white font-bold bg-gray-400">2</div>
                        <p class="text-xs mt-2 text-gray-600">ข้อมูลปลายทาง</p>
                    </div>
                    <div class="flex-1 text-center">
                        <div id="step-3-indicator" class="w-8 h-8 mx-auto rounded-full flex items-center justify-center text-white font-bold bg-gray-400">3</div>
                        <p class="text-xs mt-2 text-gray-600">รายละเอียดพัสดุ</p>
                    </div>
                    <div class="flex-1 text-center">
                        <div id="step-4-indicator" class="w-8 h-8 mx-auto rounded-full flex items-center justify-center text-white font-bold bg-gray-400">4</div>
                        <p class="text-xs mt-2 text-gray-600">สรุปและยืนยัน</p>
                    </div>
                </div>

                <form id="ship-now-form" class="space-y-6">
                    <!-- Step 1: Origin Information -->
                    <div id="ship-now-step-1" class="ship-now-step space-y-4 p-4 border border-black rounded-lg bg-yellow-50">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">ข้อมูลต้นทาง</h2>
                        <div>
                            <label for="ship-origin-country" class="block text-sm font-medium text-gray-700 mb-1">ประเทศต้นทาง:</label>
                            <select id="ship-origin-country" class="input-field" required>
                                <option value="">เลือกประเทศ</option>
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="ship-origin-city" class="block text-sm font-medium text-gray-700 mb-1">เมืองต้นทาง:</label>
                            <input type="text" id="ship-origin-city" placeholder="กรอกชื่อเมือง" class="input-field" required>
                        </div>
                        <div>
                            <label for="ship-origin-postalcode" class="block text-sm font-medium text-gray-700 mb-1">รหัสไปรษณีย์ต้นทาง (ถ้ามี):</label>
                            <input type="text" id="ship-origin-postalcode" placeholder="กรอกรหัสไปรษณีย์" class="input-field">
                        </div>
                    </div>

                    <!-- Step 2: Destination Information -->
                    <div id="ship-now-step-2" class="ship-now-step space-y-4 p-4 border border-black rounded-lg bg-yellow-50 hidden">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">ข้อมูลปลายทาง</h2>
                        <div>
                            <label for="ship-destination-country" class="block text-sm font-medium text-gray-700 mb-1">ประเทศปลายทาง:</label>
                            <select id="ship-destination-country" class="input-field" required>
                                <option value="">เลือกประเทศ</option>
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="ship-destination-city" class="block text-sm font-medium text-gray-700 mb-1">เมืองปลายทาง:</label>
                            <input type="text" id="ship-destination-city" placeholder="กรอกชื่อเมือง" class="input-field" required>
                        </div>
                        <div>
                            <label for="ship-destination-postalcode" class="block text-sm font-medium text-gray-700 mb-1">รหัสไปรษณีย์ปลายทาง (ถ้ามี):</label>
                            <input type="text" id="ship-destination-postalcode" placeholder="กรอกรหัสไปรษณีย์" class="input-field">
                        </div>
                    </div>

                    <!-- Step 3: Package Details -->
                    <div id="ship-now-step-3" class="ship-now-step space-y-4 p-4 border border-black rounded-lg bg-yellow-50 hidden">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">รายละเอียดพัสดุ</h2>
                        <div id="package-pieces-container">
                            <!-- Piece inputs will be added here by JS -->
                        </div>
                        <button type="button" id="add-piece-button" class="w-full py-2 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 transition-colors duration-200 flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                            เพิ่มชิ้นพัสดุ
                        </button>
                    </div>

                    <!-- Step 4: Review and Confirm -->
                    <div id="ship-now-step-4" class="ship-now-step space-y-6 p-4 border border-black rounded-lg bg-yellow-50 hidden">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">สรุปและยืนยัน</h2>
                        <div class="space-y-3 text-gray-700">
                            <p><span class="font-medium">ต้นทาง:</span> <span id="review-origin"></span></p>
                            <p><span class="font-medium">ปลายทาง:</span> <span id="review-destination"></span></p>
                            <p class="font-medium">รายละเอียดพัสดุ:</p>
                            <ul id="review-package-list" class="list-disc list-inside ml-4">
                                <!-- Package details will be populated by JS -->
                            </ul>
                            <p class="text-lg font-bold text-black">ค่าใช้จ่ายโดยประมาณ: (รอการคำนวณ)</p>
                        </div>
                        <button type="button" id="confirm-shipment-button" class="w-full btn-primary btn-yellow">
                            <svg class="inline-block w-5 h-5 mr-2 -mt-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: black;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            ยืนยันการจัดส่ง
                        </button>
                        <div id="shipment-result" class="mt-8 p-4 bg-red-100 border border-red-500 text-black rounded-md text-center hidden"></div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex justify-between gap-4 mt-6">
                        <a href="index.html" id="ship-now-back-to-main" class="px-6 py-3 btn-primary btn-gray">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                            กลับสู่หน้าหลัก
                        </a>
                        <button type="button" id="ship-now-prev-step" class="flex-1 btn-primary btn-gray hidden">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                            ย้อนกลับ
                        </button>
                        <button type="button" id="ship-now-next-step" class="flex-1 btn-primary btn-yellow">
                            ถัดไป
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: black;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                        </button>
                    </div>
                </form>
            </div>
        </section>

    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white py-10 px-6 md:px-10 rounded-t-xl mt-8">
        <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <h3 class="text-xl font-semibold mb-4 text-yellow-500">เกี่ยวกับ DHL</h3>
                <p class="text-gray-400 text-sm leading-relaxed">
                    DHL Express เป็นส่วนหนึ่งของ Deutsche Post DHL Group ผู้นำด้านโลจิสติกส์ของโลก เรามุ่งมั่นในการให้บริการจัดส่งพัสดุและเอกสารที่ยอดเยี่ยม
                </p>
            </div>
            <div>
                <h3 class="text-xl font-semibold mb-4 text-yellow-500">ลิงก์ด่วน</h3>
                <ul class="space-y-2">
                    <li><a href="index.html#tracking-section" class="text-gray-400 hover:text-white transition-colors duration-200 text-sm">ติดตามพัสดุ</a></li>
                    <li><a href="quote.html" class="text-gray-400 hover:text-white transition-colors duration-200 text-sm">คำนวณค่าขนส่งโดยประมาณ</a></li>
                    <li><a href="ship.html" class="text-gray-400 hover:text-white transition-colors duration-200 text-sm">สร้างใบนำส่ง</a></li>
                    <li><a href="index.html#contact-info-section" class="text-gray-400 hover:text-white transition-colors duration-200 text-sm">ติดต่อเรา</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-xl font-semibold mb-4 text-yellow-500">ติดต่อเรา</h3>
                <p class="text-gray-400 text-sm">
                    ที่อยู่: DHL Express Thailand, กรุงเทพฯ, ประเทศไทย<br />
                    โทรศัพท์: +66 2 345 6789<br />
                    อีเมล: info@dhl.co.th
                </p>
                <div class="flex space-x-4 mt-4">
                    <a href="#" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.779 1.636 4.938 4.938.058 1.265.068 1.644.068 4.849 0 3.204-.01 3.584-.069 4.85-.148 3.252-1.636-4.779-1.636-4.938-4.938-.058-1.265-.068-1.644-.068-4.85 0-3.204.01-3.584.069-4.85.148-3.252 1.636-4.779 4.938-4.938 1.266-.058 1.644-.068 4.85-.068zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.947.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.073 4.948.073 3.259 0 3.668-.014 4.947-.072 4.358-.2 6.78-2.618 6.98-6.98.059-1.281.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.2-4.358-2.618-6.78-6.98-6.98-1.281-.059-1.689-.073-4.948-.073zM12 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm4.929-10.472a1.44 1.44 0 100 2.88 1.44 1.44 0 000-2.88z"/></svg></a>
                    <a href="#" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M7.4 5.9C7.4 6.3 7.0 6.6 6.6 6.6H5.4C5.0 6.6 4.6 6.3 4.6 5.9V4.6C4.6 4.2 5.0 3.9 5.4 3.9H6.6C7.0 3.9 7.4 4.2 7.4 4.6V5.9ZM6.0 17.4C5.6 17.4 5.2 17.1 5.2 16.7V8.6C5.2 8.2 5.6 7.9 6.0 7.9H7.0C7.4 7.9 7.7 8.2 7.7 8.6V16.7C7.7 17.1 7.4 17.4 7.0 17.4H6.0ZM15.6 17.4C15.2 17.4 14.8 17.1 14.8 16.7V12.7C14.8 12.0 14.6 11.4 14.1 11.0C13.7 10.6 13.0 10.4 12.4 10.4C11.8 10.4 11.3 10.6 10.9 11.0C10.5 11.4 10.2 12.0 10.2 12.7V16.7C10.2 17.1 9.9 17.4 9.5 17.4H8.5C8.1 17.4 7.8 17.1 7.8 16.7V8.6C7.8 8.2 8.1 7.9 8.5 7.9H9.4C9.8 7.9 10.2 8.2 10.2 8.6V9.6C10.6 8.7 11.6 7.9 12.7 7.9C13.8 7.9 14.7 8.3 15.3 9.0C15.9 9.6 16.3 10.5 16.3 11.6V16.7C16.3 17.1 15.9 17.4 15.6 17.4H15.6ZM20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20Z"/></svg></a>
                </div>
            </div>
        </div>
        <div class="text-center text-gray-500 text-sm mt-8 pt-6 border-t border-gray-700">
            &copy; <span id="current-year"></span> DHL Express. สงวนลิขสิทธิ์.
        </div>
    </footer>

    <script>
        // --- Header and Footer Logic (Common to all files) ---
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Mobile menu toggle
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
            mobileMenu.classList.toggle('mobile-menu-open');
            // Toggle SVG icon
            const iconPath = mobileMenuButton.querySelector('path');
            if (mobileMenu.classList.contains('mobile-menu-open')) {
                iconPath.setAttribute('d', 'M6 18L18 6M6 6l12 12'); // X icon
            } else {
                iconPath.setAttribute('d', 'M4 6h16M4 12h16M4 18h16'); // Hamburger icon
            }
        });

        function closeMobileMenu() {
            mobileMenu.classList.add('hidden');
            mobileMenu.classList.remove('mobile-menu-open');
            const iconPath = mobileMenuButton.querySelector('path');
            iconPath.setAttribute('d', 'M4 6h16M4 12h16M4 18h16'); // Reset to Hamburger icon
        }

        // --- Ship Now Page Logic (Specific to ship.html) ---
        const shipNowCountries = ['Thailand', 'United States', 'United Kingdom', 'Germany', 'Japan', 'China', 'Singapore'];
        const shipNowOriginCountrySelect = document.getElementById('ship-origin-country');
        const shipNowDestinationCountrySelect = document.getElementById('ship-destination-country');
        const shipNowSteps = document.querySelectorAll('.ship-now-step');
        const shipNowIndicators = document.querySelectorAll('[id^="step-"][id$="-indicator"]');
        let currentShipNowStep = 0;
        let packagePieces = [];

        function initializeShipNowForm() {
            // Reset form data and steps
            document.getElementById('ship-now-form').reset();
            populateShipNowCountrySelects();
            currentShipNowStep = 0;
            packagePieces = [{ length: '', width: '', height: '', weight: '' }]; // Start with one piece
            renderPackagePieces();
            updateShipNowStep(currentShipNowStep);
            document.getElementById('shipment-result').classList.add('hidden');
            document.getElementById('shipment-result').textContent = '';
        }

        function populateShipNowCountrySelects() {
            shipNowOriginCountrySelect.innerHTML = '<option value="">เลือกประเทศ</option>';
            shipNowDestinationCountrySelect.innerHTML = '<option value="">เลือกประเทศ</option>';
            shipNowCountries.forEach(country => {
                const option1 = document.createElement('option');
                option1.value = country;
                option1.textContent = country;
                shipNowOriginCountrySelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = country;
                option2.textContent = country;
                shipNowDestinationCountrySelect.appendChild(option2);
            });
        }

        function updateShipNowStep(stepIndex) {
            shipNowSteps.forEach((step, index) => {
                if (index === stepIndex) {
                    step.classList.remove('hidden');
                } else {
                    step.classList.add('hidden');
                }
            });

            shipNowIndicators.forEach((indicator, index) => {
                indicator.classList.remove('bg-red-600', 'bg-yellow-500', 'font-semibold', 'text-red-600'); /* Changed colors */
                indicator.classList.add('bg-gray-400', 'text-gray-600'); // Reset all to gray

                const textElement = indicator.nextElementSibling; // The <p> tag with step name
                if (textElement) {
                    textElement.classList.remove('font-semibold', 'text-red-600'); /* Changed colors */
                    textElement.classList.add('text-gray-600');
                }

                if (index === stepIndex) {
                    indicator.classList.add('bg-red-600'); /* Changed to red */
                    const currentTextElement = indicator.nextElementSibling;
                    if (currentTextElement) {
                        currentTextElement.classList.add('font-semibold', 'text-red-600'); /* Changed to red */
                    }
                } else if (index < stepIndex) {
                    indicator.classList.add('bg-yellow-500'); /* Changed to yellow for completed steps */
                }
            });

            const prevButton = document.getElementById('ship-now-prev-step');
            const nextButton = document.getElementById('ship-now-next-step');
            const backToMainLink = document.getElementById('ship-now-back-to-main'); // Changed to link

            if (stepIndex === 0) {
                prevButton.classList.add('hidden');
                backToMainLink.classList.remove('hidden'); // Show "Back to main"
            } else {
                prevButton.classList.remove('hidden');
                backToMainLink.classList.add('hidden'); // Hide "Back to main"
            }

            if (stepIndex === shipNowSteps.length - 1) {
                nextButton.classList.add('hidden');
                document.getElementById('confirm-shipment-button').classList.remove('hidden'); // Show confirm button
            } else {
                nextButton.classList.remove('hidden');
                document.getElementById('confirm-shipment-button').classList.add('hidden'); // Hide confirm button
            }

            // Populate review step if on last step
            if (stepIndex === shipNowSteps.length - 1) {
                populateReviewStep();
            }
        }

        function validateShipNowStep(stepIndex) {
            let isValid = true;
            const shipmentResultDiv = document.getElementById('shipment-result'); // Get the result div
            shipmentResultDiv.classList.add('hidden'); // Hide previous messages

            if (stepIndex === 0) { // Origin Step
                const country = shipNowOriginCountrySelect.value;
                const city = document.getElementById('ship-origin-city').value.trim();
                if (!country || !city) {
                    shipmentResultDiv.textContent = 'กรุณากรอกประเทศและเมืองต้นทางให้ครบถ้วน';
                    shipmentResultDiv.classList.remove('hidden');
                    isValid = false;
                }
            } else if (stepIndex === 1) { // Destination Step
                const country = shipNowDestinationCountrySelect.value;
                const city = document.getElementById('ship-destination-city').value.trim();
                if (!country || !city) {
                    shipmentResultDiv.textContent = 'กรุณากรอกประเทศและเมืองปลายทางให้ครบถ้วน';
                    shipmentResultDiv.classList.remove('hidden');
                    isValid = false;
                }
            } else if (stepIndex === 2) { // Package Step
                if (packagePieces.length === 0) {
                    shipmentResultDiv.textContent = 'กรุณาเพิ่มรายละเอียดพัสดุอย่างน้อยหนึ่งชิ้น';
                    shipmentResultDiv.classList.remove('hidden');
                    isValid = false;
                } else {
                    for (const piece of packagePieces) {
                        if (!piece.length || !piece.width || !piece.height || !piece.weight) {
                            shipmentResultDiv.textContent = 'กรุณากรอกขนาดและน้ำหนักพัสดุให้ครบถ้วนในทุกชิ้น';
                            shipmentResultDiv.classList.remove('hidden');
                            isValid = false;
                            break;
                        }
                    }
                }
            }
            return isValid;
        }

        document.getElementById('ship-now-next-step').addEventListener('click', () => {
            if (validateShipNowStep(currentShipNowStep)) {
                currentShipNowStep++;
                updateShipNowStep(currentShipNowStep);
            }
        });

        document.getElementById('ship-now-prev-step').addEventListener('click', () => {
            currentShipNowStep--;
            updateShipNowStep(currentShipNowStep);
        });

        // Package Pieces Management
        const packagePiecesContainer = document.getElementById('package-pieces-container');

        function renderPackagePieces() {
            packagePiecesContainer.innerHTML = ''; // Clear existing
            packagePieces.forEach((piece, index) => {
                const pieceDiv = document.createElement('div');
                pieceDiv.className = 'border border-black rounded-md p-4 mb-4 bg-white shadow-sm relative'; /* Changed border-gray-300 to border-black */
                pieceDiv.innerHTML = `
                    <h3 class="text-lg font-medium text-gray-700 mb-3">ชิ้นที่ ${index + 1}</h3>
                    ${packagePieces.length > 1 ? `
                    <button type="button" class="absolute top-2 right-2 text-red-500 hover:text-red-700 rounded-full p-1 focus:outline-none focus:ring-2 focus:ring-red-500" data-index="${index}" aria-label="Remove piece">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </button>
                    ` : ''}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label for="ship-length-${index}" class="block text-sm font-medium text-gray-700 mb-1">ความยาว (ซม.):</label>
                            <input type="number" id="ship-length-${index}" placeholder="ยาว" min="0.1" step="0.1" class="input-field" value="${piece.length}" required data-field="length">
                        </div>
                        <div>
                            <label for="ship-width-${index}" class="block text-sm font-medium text-gray-700 mb-1">ความกว้าง (ซม.):</label>
                            <input type="number" id="ship-width-${index}" placeholder="กว้าง" min="0.1" step="0.1" class="input-field" value="${piece.width}" required data-field="width">
                        </div>
                        <div>
                            <label for="ship-height-${index}" class="block text-sm font-medium text-gray-700 mb-1">ความสูง (ซม.):</label>
                            <input type="number" id="ship-height-${index}" placeholder="สูง" min="0.1" step="0.1" class="input-field" value="${piece.height}" required data-field="height">
                        </div>
                        <div>
                            <label for="ship-weight-${index}" class="block text-sm font-medium text-gray-700 mb-1">น้ำหนัก (กก.):</label>
                            <input type="number" id="ship-weight-${index}" placeholder="น้ำหนัก" min="0.1" step="0.1" class="input-field" value="${piece.weight}" required data-field="weight">
                        </div>
                    </div>
                `;
                packagePiecesContainer.appendChild(pieceDiv);

                // Add event listeners for inputs
                pieceDiv.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', (e) => {
                        const field = e.target.dataset.field;
                        packagePieces[index][field] = e.target.value;
                    });
                });
            });

            // Add event listeners for remove buttons
            packagePiecesContainer.querySelectorAll('button[data-index]').forEach(button => {
                button.addEventListener('click', (e) => {
                    const indexToRemove = parseInt(e.currentTarget.dataset.index);
                    packagePieces.splice(indexToRemove, 1);
                    renderPackagePieces(); // Re-render after removal
                });
            });
        }

        document.getElementById('add-piece-button').addEventListener('click', () => {
            packagePieces.push({ length: '', width: '', height: '', weight: '' });
            renderPackagePieces();
        });


        // Review Step Population
        function populateReviewStep() {
            const reviewOrigin = document.getElementById('review-origin');
            const reviewDestination = document.getElementById('review-destination');
            const reviewPackageList = document.getElementById('review-package-list');

            const originCountry = shipNowOriginCountrySelect.value;
            const originCity = document.getElementById('ship-origin-city').value;
            const originPostalCode = document.getElementById('ship-origin-postalcode').value;

            const destinationCountry = shipNowDestinationCountrySelect.value;
            const destinationCity = document.getElementById('ship-destination-city').value;
            const destinationPostalCode = document.getElementById('ship-destination-postalcode').value;

            reviewOrigin.textContent = `${originCity}, ${originCountry} ${originPostalCode ? '(' + originPostalCode + ')' : ''}`;
            reviewDestination.textContent = `${destinationCity}, ${destinationCountry} ${destinationPostalCode ? '(' + destinationPostalCode + ')' : ''}`;

            reviewPackageList.innerHTML = '';
            packagePieces.forEach((piece, index) => {
                const li = document.createElement('li');
                li.textContent = `ชิ้นที่ ${index + 1}: ยาว ${piece.length} ซม., กว้าง ${piece.width} ซม., สูง ${piece.height} ซม., น้ำหนัก ${piece.weight} กก.`;
                reviewPackageList.appendChild(li);
            });
        }

        document.getElementById('confirm-shipment-button').addEventListener('click', () => {
            // This is the final submission for Ship Now
            const shipmentResultDiv = document.getElementById('shipment-result');
            
            const finalData = {
                origin: {
                    country: shipNowOriginCountrySelect.value,
                    city: document.getElementById('ship-origin-city').value,
                    postalCode: document.getElementById('ship-origin-postalcode').value
                },
                destination: {
                    country: shipNowDestinationCountrySelect.value,
                    city: document.getElementById('ship-destination-city').value,
                    postalCode: document.getElementById('ship-destination-postalcode').value
                },
                package: packagePieces.map(piece => ({ // Ensure data is parsed to numbers
                    length: parseFloat(piece.length),
                    width: parseFloat(piece.width),
                    height: parseFloat(piece.height),
                    weight: parseFloat(piece.weight)
                }))
            };

            console.log("Final shipment data to be sent:", finalData);
            shipmentResultDiv.textContent = "กำลังดำเนินการจัดส่ง... (นี่คือการจำลอง)";
            shipmentResultDiv.classList.remove('hidden');

            /*
            fetch('YOUR_VB_NET_API_ENDPOINT/createShipment', { // <<< เปลี่ยนเป็น URL API ของคุณที่นี่
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(finalData)
            })
            .then(response => response.json())
            .then(data => {
                shipmentResultDiv.textContent = `การจัดส่งของคุณ ${data.trackingNumber} ถูกสร้างขึ้นแล้ว!`;
                shipmentResultDiv.classList.remove('hidden');
                // Optionally redirect or provide next steps
            })
            .catch(error => {
                console.error('Error creating shipment:', error);
                shipmentResultDiv.textContent = 'เกิดข้อผิดพลาดในการสร้างการจัดส่ง';
                shipmentResultDiv.classList.remove('hidden');
            });
            */
        });


        // --- Initial Load Logic for ship.html ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeShipNowForm(); // Initialize ship now form on load
        });
    </script>
</body>
</html>
